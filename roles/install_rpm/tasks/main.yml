---
- name: change some variables when using package manager
  set_fact:
    goal_user: algorand
    goal_user_group: algorand
    node_directory: /var/lib/algorand
    node_data_directory: /var/lib/algorand
    goal_executable: "goal"
    diagcfg_executable: "diagcfg"
  tags: algorand-node-setup

- name: add Algorand rpm-key
  ansible.builtin.rpm_key:
    key: https://releases.algorand.com/rpm/rpm_algorand.pub
    state: present
  tags: algorand-node-setup

- include: dnf_install.yml
  when: os_family == "RedHat"

- include: zypper_install.yml
  when: os_family == "Suse"

- name: ensure Algorand node installation was successful
  command: algod -v
  changed_when: false
  tags: algorand-node-setup

- name: add Algorand environment variables exporting to admin user's .bash_profile
  lineinfile:
    dest: "{{ admin_home_directory }}/.bash_profile"
    line: 'export ALGORAND_DATA="{{ node_data_directory }}"'
    state: present
    create: yes
  become: yes
  become_user: "{{ admin_user }}"
  tags: algorand-node-setup
