---
- name: copy {{ algorand_network }} genesis file to data directory
  copy:
    src: "/var/lib/algorand/genesis/{{ algorand_network }}/genesis.json"
    dest: "/var/lib/algorand/genesis.json"
    remote_src: yes
    owner: algorand
    group: algorand
    mode: 0644
  register: network_switched
  become: yes
  tags: switch-network

- name: restart Algorand service
  systemd:
    name: algorand
    state: restarted
  become: yes
  when: network_switched.changed
  tags: switch-network

- name: ensure Algorand service is in a running state
  service:
    name: algorand
    state: started
  register: algorand_service_active
  until: algorand_service_active.status.ActiveState == "active"
  retries: 5
  delay: 5
  become: yes
  tags: switch-network

- name: wait until the file /var/lib/algorand/algod.net is present
  wait_for:
    path: /var/lib/algorand/algod.net
  become: yes
  tags: switch-network

- name: ensure Algorand runs in {{ algorand_network }}
  command: goal node status -d /var/lib/algorand
  register: node_status
  failed_when: 'algorand_network|string not in node_status.stdout'
  changed_when: false
  become: yes
  tags: switch-network
