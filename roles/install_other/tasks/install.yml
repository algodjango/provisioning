---
- name: download the updater script
  get_url:
    url: https://raw.githubusercontent.com/algorand/go-algorand-doc/master/downloads/installers/update.sh
    dest: "{{ node_directory }}update_by_ansible.sh"
    owner: "{{ admin_user }}"
    group: "{{ admin_user_group }}"
    mode: 0755
  register: updater_downloaded
  tags: algorand-node-setup

- name: copy newer updater script
  copy:
    src: "{{ node_directory }}update_by_ansible.sh"
    dest: "{{ node_directory }}update.sh"
    remote_src: yes
    owner: "{{ admin_user }}"
    group: "{{ admin_user_group }}"
    mode: 0755
  when: updater_downloaded.changed
  register: updater_file
  tags: algorand-node-setup

- name: run the installer
  shell: "yes 'y' | ./update.sh -i -c stable -p {{ node_directory }} -d {{ node_data_directory }} -n"
  args:
    chdir: "{{ node_directory }}"
  when: updater_file.changed
  tags: algorand-node-setup
